<div class="header">
    <h2>Parts Inventory</h2>
    <div class="header-actions">
        <label class="toggle">
            <input type="checkbox" [(ngModel)]="showLowStockOnly">
            <span>Show Low Stock Only ({{ lowStockParts.length }})</span>
        </label>
        <button class="btn-primary" (click)="openAdd()">+ Add Part</button>
    </div>
</div>

<div class="success-message" *ngIf="successMessage">{{ successMessage }}</div>

<div class="low-stock-alert" *ngIf="lowStockParts.length > 0 && !showLowStockOnly">
    {{ lowStockParts.length }} parts are running low on stock!
</div>

<div class="card-list" *ngIf="!restockMode && !thresholdMode && !addMode">
    <div *ngFor="let part of getParts()" class="card"
        [class.low-stock]="part.availableQuantity <= part.lowStockThreshold">
        <div class="card-info">
            <strong>{{ part.name }}</strong>
            <span>ID: {{ part.id }}</span>
            <span>Category: {{ part.category }}</span>
            <span>Price: ₹{{ part.unitPrice }}</span>
        </div>
        <div class="card-stats">
            <span class="quantity">Stock: {{ part.availableQuantity }}</span>
            <span class="threshold">Threshold: {{ part.lowStockThreshold }}</span>
        </div>
        <div class="card-actions">
            <button class="btn-secondary btn-small" (click)="openRestock(part)">Restock</button>
            <button class="btn-secondary btn-small" (click)="openThreshold(part)">Set Threshold</button>
        </div>
    </div>
    <p *ngIf="getParts().length === 0" class="no-data">No parts found.</p>
</div>

<div class="modal-panel" *ngIf="restockMode">
    <h3>Restock Part</h3>
    <p><strong>{{ selectedPart?.name }}</strong></p>
    <p>Current Stock: {{ selectedPart?.availableQuantity }}</p>

    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="form-group">
        <label for="quantity">Add Quantity</label>
        <input type="number" id="quantity" [(ngModel)]="restockQuantity" min="1">
    </div>

    <div class="button-group">
        <button class="btn-primary" (click)="restock()">Restock</button>
        <button class="btn-secondary" (click)="cancel()">Cancel</button>
    </div>
</div>

<div class="modal-panel" *ngIf="thresholdMode">
    <h3>Set Low Stock Threshold</h3>
    <p><strong>{{ selectedPart?.name }}</strong></p>

    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="form-group">
        <label for="threshold">Threshold</label>
        <input type="number" id="threshold" [(ngModel)]="newThreshold" min="0">
    </div>

    <div class="button-group">
        <button class="btn-primary" (click)="updateThreshold()">Update</button>
        <button class="btn-secondary" (click)="cancel()">Cancel</button>
    </div>
</div>

<div class="modal-panel" *ngIf="addMode">
    <h3>Add New Part</h3>

    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="form-group">
        <label for="name">Part Name</label>
        <input type="text" id="name" [(ngModel)]="newPart.name">
    </div>

    <div class="form-group">
        <label for="category">Category</label>
        <input type="text" id="category" [(ngModel)]="newPart.category">
    </div>

    <div class="form-group">
        <label for="qty">Initial Quantity</label>
        <input type="number" id="qty" [(ngModel)]="newPart.availableQuantity" min="0">
    </div>

    <div class="form-group">
        <label for="price">Unit Price (₹)</label>
        <input type="number" id="price" [(ngModel)]="newPart.unitPrice" min="0">
    </div>

    <div class="button-group">
        <button class="btn-primary" (click)="addPart()">Add Part</button>
        <button class="btn-secondary" (click)="cancel()">Cancel</button>
    </div>
</div>